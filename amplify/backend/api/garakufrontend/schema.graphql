# This "input" configures a global authorization rule to enable public access to
# all models in this schema. Learn more about authorization rules here: https://docs.amplify.aws/cli/graphql/authorization-rules
input AMPLIFY {
  globalAuthRule: AuthRule = { allow: public }
} # FOR TESTING ONLY!
type Staff @model @auth(rules: [{ allow: private }]) {
  id: ID!
  cognitoUserId: String!
    @index(
      name: "byCognitoUserId"
      sortKeyFields: ["id"]
      queryField: "staffByCognitoUserId"
    )
  familyName: String
  givenName: String
  mailAddress: String!
  role: String!
  enabled: Boolean!
  status: String!
  owner: Boolean
  usageStartDate: String
  notifications: Notification
  sortKey: String
  workType: String
  developer: Boolean
  approverSetting: ApproverSettingMode
  approverSingle: String
  approverMultiple: [String]
  approverMultipleMode: ApproverMultipleMode
}

enum ApproverSettingMode {
  ADMINS
  SINGLE
  MULTIPLE
}

enum ApproverMultipleMode {
  ANY
  ORDER
}

type Notification {
  workStart: Boolean
  workEnd: Boolean
}

type HolidayCalendar @model @auth(rules: [{ allow: private }]) {
  id: ID!
  holidayDate: String!
  name: String!
}

type CompanyHolidayCalendar @model @auth(rules: [{ allow: private }]) {
  id: ID!
  holidayDate: String!
  name: String!
}

type CloseDate @model @auth(rules: [{ allow: private }]) {
  id: ID!
  closeDate: String!
  startDate: String!
  endDate: String!
}

type SystemComment {
  comment: String!
  confirmed: Boolean!
  createdAt: String!
}

type Attendance @model @auth(rules: [{ allow: private }]) {
  id: ID!
  staffId: String!
    @index(
      name: "byStaffId"
      sortKeyFields: ["workDate"]
      queryField: "attendancesByStaffId"
    )
  workDate: String!
  startTime: String
  endTime: String
  goDirectlyFlag: Boolean
  returnDirectlyFlag: Boolean
  absentFlag: Boolean
  rests: [Rest]
  hourlyPaidHolidayTimes: [HourlyPaidHolidayTime]
  remarks: String
  paidHolidayFlag: Boolean
  specialHolidayFlag: Boolean
  isDeemedHoliday: Boolean
  hourlyPaidHolidayHours: Int
  substituteHolidayDate: String
  histories: [AttendanceHistory]
  changeRequests: [AttendanceChangeRequest]
  systemComments: [SystemComment]
  revision: Int
}

type Document @model @auth(rules: [{ allow: private }]) {
  id: ID!
  title: String!
  content: String!
  tag: [String]
  targetRole: [String]
  revision: Int
}

type CheckForUpdate @model {
  id: ID!
  deployUuid: String!
}

type Rest {
  startTime: String
  endTime: String
}

type AttendanceHistory {
  staffId: String!
  workDate: String!
  startTime: String
  endTime: String
  goDirectlyFlag: Boolean
  absentFlag: Boolean
  returnDirectlyFlag: Boolean
  rests: [Rest]
  hourlyPaidHolidayTimes: [HourlyPaidHolidayTime]
  remarks: String
  paidHolidayFlag: Boolean
  specialHolidayFlag: Boolean
  hourlyPaidHolidayHours: Int
  substituteHolidayFlag: Boolean
  substituteHolidayDate: String
  createdAt: String!
}

type AttendanceChangeRequest {
  startTime: String
  endTime: String
  goDirectlyFlag: Boolean
  absentFlag: Boolean
  returnDirectlyFlag: Boolean
  rests: [Rest]
  hourlyPaidHolidayTimes: [HourlyPaidHolidayTime]
  remarks: String
  paidHolidayFlag: Boolean
  specialHolidayFlag: Boolean
  hourlyPaidHolidayHours: Int
  substituteHolidayFlag: Boolean
  substituteHolidayDate: String
  completed: Boolean
  comment: String
  staffComment: String
}

type Link {
  label: String!
  url: String!
  enabled: Boolean!
  icon: String
}

type Reason {
  reason: String!
  enabled: Boolean!
}

type QuickInputTime {
  time: String!
  enabled: Boolean!
}

type AppConfig @model {
  id: ID!
  name: String!
  workStartTime: String
  workEndTime: String
  lunchRestStartTime: String
  lunchRestEndTime: String
  amHolidayStartTime: String
  amHolidayEndTime: String
  pmHolidayStartTime: String
  pmHolidayEndTime: String
  specialHolidayEnabled: Boolean
  amPmHolidayEnabled: Boolean
  officeMode: Boolean
  absentEnabled: Boolean
  hourlyPaidHolidayEnabled: Boolean
  links: [Link]
  reasons: [Reason]
  quickInputStartTimes: [QuickInputTime]
  quickInputEndTimes: [QuickInputTime]
}

type EmailResult {
  statusCode: Int
  body: String
}

input EmailData {
  to: [String]
  subject: String!
  body: String!
}

type Query {
  sendMail(data: EmailData!): EmailResult
    @function(name: "garakuSendMail-${env}")
}

type HourlyPaidHolidayTime {
  startTime: String!
  endTime: String!
}

enum WorkflowCategory {
  PAID_LEAVE
  ABSENCE
  OVERTIME
  CUSTOM
}

enum WorkflowStatus {
  DRAFT
  SUBMITTED
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

type OverTimeWorkflow {
  date: String!
  startTime: String!
  endTime: String!
  reason: String!
}

type WorkflowComment {
  id: ID!
  staffId: String!
  text: String!
  createdAt: String!
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  SKIPPED
}

type ApprovalStep {
  id: ID!
  approverStaffId: String!
  decisionStatus: ApprovalStatus!
  approverComment: String
  decisionTimestamp: String
  stepOrder: Int
}

type Workflow @model @auth(rules: [{ allow: private }]) {
  id: ID!
  approvedStaffIds: [String]
  rejectedStaffIds: [String]
  finalDecisionTimestamp: String
  category: WorkflowCategory
  staffId: String! @index(name: "byStaffId", queryField: "workflowsByStaffId")
  status: WorkflowStatus!
  assignedApproverStaffIds: [String]
  approvalSteps: [ApprovalStep]
  nextApprovalStepIndex: Int
  submitterApproverSetting: ApproverSettingMode
  submitterApproverId: String
  submitterApproverIds: [String]
  submitterApproverMultipleMode: ApproverMultipleMode
  overTimeDetails: OverTimeWorkflow
  comments: [WorkflowComment]
}

type OperationLog @model @auth(rules: [{ allow: private }]) {
  id: ID!
  staffId: String
    @index(
      name: "byStaffId"
      sortKeyFields: ["timestamp"]
      queryField: "operationLogsByStaffId"
    )
  # 行った操作の種類（例: "LOGIN", "ATTENDANCE_UPDATE"）
  action: String!
  # 対象リソースの種類（例: "Attendance", "Workflow", "AppConfig"）
  resource: String
  # 対象リソースの ID（あれば）
  resourceId: String
  # ISO 8601 形式のタイムスタンプ
  timestamp: String!
  # 操作の詳細を JSON 文字列などで保存
  details: String
  # オプション: 発生元 IP
  ipAddress: String
  # オプション: ユーザーエージェント
  userAgent: String
  # 任意の追加メタデータ（JSON 文字列）
  metadata: String
  # 重大度レベル（例: INFO, WARN, ERROR）
  severity: String
}
