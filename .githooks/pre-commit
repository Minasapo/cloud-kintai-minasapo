#!/bin/sh

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR)
TARGET_FILES=$(echo "$STAGED_FILES" | grep -E '^src/.*\.(js|jsx|ts|tsx)$' | grep -v '^src/api/' || true)

if [ -z "$TARGET_FILES" ]; then
  exit 0
fi

echo "Running ESLint for staged src files..."
echo "========================================"

echo "$TARGET_FILES" | xargs npx eslint --cache --cache-location .eslintcache
if [ $? -ne 0 ]; then
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@ ESLint failed, aborting commit"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  exit 1
fi

echo "========================================"
